var test = require('tape'),
    fs = require('fs'),
    lex = require('./');

test('lex', function(t) {
    fs.readdirSync('fixture').filter(function(file) {
        return file.match(/input$/);
    }).forEach(function(file) {
        var inputName = 'fixture/' + file;
        var outputName = 'fixture/' + file.replace('.input', '.output');
        var contents = fs.readFileSync(inputName, 'utf8');
        var output = lex(contents);
        if (process.env.UPDATE) {
            fs.writeFileSync(outputName, JSON.stringify(output, null, 2));
        }
        t.deepEqual(JSON.parse(fs.readFileSync(outputName)),
                output, file);
    });
    t.end();
});
